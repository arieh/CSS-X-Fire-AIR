<html>
    <head>
        <title>New Adobe AIR Project</title>
        <script type="text/javascript" src="lib/air/AIRAliases.js"></script>
        <script type="text/javascript" src="lib/air/AIRMenuBuilder.js"></script>
        <script type="text/javascript" src="lib/air/AIRSourceViewer.js"></script>
		<script type="text/javascript" src="lib/mootools-core-1.3.js"></script>
		<script type="text/javascript" src="lib/mootools-more.js"></script>
        <script src="lib/db-setup.js"></script>
		<script src="lib/FolderTable.js"></script>
		<script src='lib/SocketHandler.js'></script>
        <script src='lib/CSSHandler.js'></script>
		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/main.css">
    </head>
    <body>
    	<div id='wrapper'>
    	<nav>
	    	<button id='start'>Start</button> 
			<button id='end'>End</button>
			<button id='manage_sites'>Manage Sites</button>
			<button id="settings">Settings</abutton
		</nav>
		<div id='sites_cont'>
		<table id='sites'>
    		<thead>
    			<tr>
    				<th>Site Address</th>
					<th>Folder</th>
				    <th></th>
    			</tr>
    		</thead>
			<tbody>
				
			</tbody>
			<tfoot>
				<tr>					<td colspan="3">
				        <form id='add_folder' action="#">
				            <label for='address'>Address</label>
				            <input type='url' id='address' name='address' placeholder="Your site's address" />
				            <label for='folder'>Folder</label>
				            <input type='text' id='folder' name='folder' placeholder="You site's folder on the server" />
				            <input type='submit' value='add folder' />
				        </form>		
					</td>				</tr>
			</tfoot>
    	</table>
		</div>
		<h1>Changes</h1>
		<table id='changes'>			<thead>
				<tr>					<th>File</th>					<th>Prop</th>					<th>Value</th>					<th>Action</th>				</tr>
			</thead>			<tbody>
				
			</tbody>		</table>
		</div>
    	<script type="text/javascript">
			var sites_open = false
              , sites_fx = new Fx.Tween('sites_cont')
			  , changes = $$('#changes tbody')[0]
			  , on = false
	          , table = new FolderTable('sites',__db__)
	          , socket = new SocketHandler()
	          , css = new CSSHandler(table,__db__);
			  
            socket.addEvent('response',css.handleResponse);
			
			$('start').addEvent('click',function(){socket.listen();on = true;});
			$('end').addEvent('click',function(){socket.close();on = false;});		
			 
			$('sites_cont').addEvent('click',function(e){
			     var url;
				 if (e.target.get('tag')=='a'){
				 	var url = $(e.target).getParent('tr').getElement('.url').get('text').trim();
					table.removeSite(url);
				 }
			});
			
			$('manage_sites').addEvent('click',function(){
				sites_fx.start('height',sites_open ? 0 : '150px');
				sites_open = sites_open ? false : true;
			});
			
			$('add_folder').addEvent('submit',function(){
				table.addSite($('address').value,$('folder').value);
			});
			
			
			css.addEvent('write',function(data){
				changes.adopt(
				    new Element('tr').adopt(
					    new Element('td',{html:data.src})
						, new Element('td',{html:data.property})
						, new Element('td',{html:data.value})
						, new Element('td',{html:data.action})
				    )
				);				
			});
        </script>
    </body>
</html>
